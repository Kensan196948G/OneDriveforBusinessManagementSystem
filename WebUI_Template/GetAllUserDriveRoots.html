<!DOCTYPE html>
<html>
<head>
<title>ユーザードライブルートレポート</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<link href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.bootstrap5.min.css" rel="stylesheet">
<style>
/* 既存のCSSスタイルを継承 */
.loading-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255,255,255,0.9);
    z-index: 9999;
    justify-content: center;
    align-items: center;
}

.loading-spinner {
    text-align: center;
    padding: 20px;
    border-radius: 8px;
    background: white;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

/* カラムカラーをドライブルート用に調整 */
:root {
  --user-color: #4fc3f7;
  --drive-color: #ffd54f;
  --created-color: #81c784;
  --modified-color: #ba68c8;
  --status-color: #ff5252;
}

.column-user { background-color: var(--user-color); color: white; }
.column-drive { background: linear-gradient(135deg, var(--drive-color), #ffb74d); color: #333; }
.column-created { background-color: var(--created-color); color: white; }
.column-modified { background-color: var(--modified-color); color: white; }
.column-status { background-color: var(--status-color); color: white; }

/* カラム幅設定 */
.column-user { width: 15%; }
.column-drive { width: 40%; }
.column-created { width: 15%; }
.column-modified { width: 15%; }
.column-status { width: 15%; }

/* 既存の共通スタイルを継承 */
body {
    padding: 20px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}
.table thead th {
    position: sticky;
    top: 0;
    background-color: #f8f9fa;
    z-index: 10;
}
</style>
</head>
<body>
<!-- ローディングオーバーレイ -->
<div id="loadingOverlay" class="loading-overlay">
    <div class="loading-spinner">
        <i class="fas fa-spinner fa-spin"></i>
        <div class="mt-2">ドライブルート情報を取得中です...お待ちください</div>
    </div>
</div>

<div class="container">
    <h1 class="text-center mb-4">
      <i class="fas fa-folder-open me-3 text-primary"></i>
      ユーザードライブルートレポート
      <i class="fas fa-table ms-3 text-primary"></i>
    </h1>

    <div class="filter-container">
        <div class="row mb-3">
            <div class="col-md-4">
                <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-search"></i></span>
                    <input type="text" class="form-control" id="globalSearch" placeholder="全体検索..." onkeyup="filterTable()">
                </div>
            </div>
            <div class="col-md-3">
                <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-list-ol"></i></span>
                    <select class="form-select" id="entriesPerPage" onchange="updatePageSize()">
                        <option value="10">10件表示</option>
                        <option value="20">20件表示</option>
                        <option value="50">50件表示</option>
                        <option value="100">100件表示</option>
                        <option value="0">全件表示</option>
                    </select>
                </div>
            </div>
            <div class="col-md-5 text-end">
                <button class="btn btn-outline-primary me-2" onclick="exportToCsv()">
                    <i class="fas fa-file-csv me-1"></i>CSVエクスポート
                </button>
                <button class="btn btn-outline-secondary me-2" onclick="window.print()">
                    <i class="fas fa-print me-1"></i>印刷
                </button>
                <button class="btn btn-outline-success" onclick="refreshData()">
                    <i class="fas fa-sync-alt me-1"></i>更新
                </button>
            </div>
        </div>
    </div>

    <div class="table-responsive">
        <table class="table table-hover" id="dataTable">
            <thead>
                <tr>
                    <th class="column-user">
                        <i class="fas fa-user-circle me-1"></i>
                        <span class="badge bg-white text-dark header-text">ユーザー名</span>
                    </th>
                    <th class="column-drive">
                        <i class="fas fa-link me-1"></i>
                        <span class="badge bg-white text-dark header-text">ドライブURL</span>
                    </th>
                    <th class="column-created">
                        <i class="fas fa-calendar-plus me-1"></i>
                        <span class="badge bg-white text-dark header-text">作成日時</span>
                    </th>
                    <th class="column-modified">
                        <i class="fas fa-calendar-check me-1"></i>
                        <span class="badge bg-white text-dark header-text">最終更新</span>
                    </th>
                    <th class="column-status">
                        <i class="fas fa-shield-alt me-1"></i>
                        <span class="badge bg-white text-dark header-text">状態</span>
                    </th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>
    
    <!-- データ取得エラーコンテナ -->
    <div id="errorContainer" class="alert alert-danger mt-3 mb-5 mx-auto" style="display: none;">
        <div class="d-flex align-items-start px-3 py-2">
            <i class="fas fa-exclamation-triangle fa-3x me-4 mt-1" style="min-width: 48px;"></i>
            <div>
                <h3 class="alert-heading mb-3 text-danger">データ取得エラー</h3>
                <p id="errorMessage" class="mb-3 fs-5"></p>
                <div class="d-flex gap-3 mt-3">
                    <button class="btn btn-danger px-4 py-2" onclick="handleReload()">
                        <i class="fas fa-sync-alt me-2"></i>再読み込み
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.2.9/js/responsive.bootstrap5.min.js"></script>
<script src="common.js"></script>

<script>
// ローディング表示制御
function showLoading() {
    document.getElementById('loadingOverlay').style.display = 'flex';
}

function hideLoading() {
    document.getElementById('loadingOverlay').style.display = 'none';
}

// エラー表示
function showError(message) {
    document.getElementById('errorMessage').textContent = message;
    document.getElementById('errorContainer').style.display = 'block';
}

// 初期表示設定
document.addEventListener('DOMContentLoaded', function() {
    showLoading();
    setTimeout(() => {
        hideLoading();
        showError('ドライブルート情報の取得に失敗しました。GetAllUserDriveRoots.ps1を実行してください。');
    }, 2000);
});

// データ取得関数
async function fetchData() {
    showLoading();
    try {
        // ここに実際のデータ取得処理を実装
        hideLoading();
    } catch (error) {
        hideLoading();
        showError('ドライブルート情報の取得中にエラーが発生しました: ' + error.message);
    }
}

// ページ再読み込み処理
function handleReload() {
    location.reload();
}
</script>
</body>
</html>